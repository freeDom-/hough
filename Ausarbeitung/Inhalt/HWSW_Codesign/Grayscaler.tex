Der Grayscaler wandelt ein RGB-Bild nach \autoref{sec:umwandlung-eines-rgb-bildes-in-graustufen} in ein Graustufenbild um. Dabei erhält das Modul als Eingabe einen Zeiger auf 32 Bit breite Pixeldaten, die Höhe und die Breite des Bildes. Anschließend wird jedes Pixel durchlaufen und der neue Intensitätswert wie in \autoref{lst:grayscaler} Z. \ref{lst:grayscaler_output} berechnet. Die einzelnen Werte für Rot, Grün und Blau berechnen sich in Z. \ref{lst:grayscaler_rgb_start} - \ref{lst:grayscaler_rgb_end}. Als Pixelformat wurde \emph{ARGB8888} gewählt, welches in \autoref{img:argb-format} näher dargestellt ist. Die Bits 31 bis 24 enthalten den Alphawert des jeweiligen Pixels, die Bits 23 bis 16 den Rotwert, die Bits 15 bis 8 den Grünwert und die Bit 7 bis 0 den Blauwert.

\begin{figure}[H]
	\centering
	\includegraphics[width=0.8\linewidth]{Bilder/ARGB_format.png}
	\caption[Pixelformat ARGB]{Darstellung des Pixelformates ARGB8888}
	\label{img:argb-format}
\end{figure}

Die For-Schleifen, in welchen das gesamte Bild durchlaufen und verarbeitet wird, werden in den Z. \ref{lst:grayscaler_omp_start} - \ref{lst:grayscaler_omp_end} parallelisiert, falls \ac{OMP} verwendet wird.

\begin{lstlisting}[label=lst:grayscaler,caption=Auszug aus grayscaler.c]
uint8_t* grayscaler(uint32_t* input, unsigned int width, unsigned int height) {
	uint8_t *output = malloc(width * height * sizeof(uint8_t));
	
	#ifdef _OPENMP(@\label{lst:grayscaler_omp_start}@)
	#pragma omp parallel for
	#endif(@\label{lst:grayscaler_omp_end}@)
	// Convert image to grayscale
	for(int y = 0; y < height; y++) {(@\label{lst:grayscaler_outer_loop}@)
		for(int x = 0; x < width; x++) {(@\label{lst:grayscaler_inner_loop}@)
			uint8_t r, g, b;
			int index = y * width + x;
			
			r = input[index] >> 16 & 0xFF;(@\label{lst:grayscaler_rgb_start}@)
			g = input[index] >> 8 & 0xFF;
			b = input[index] & 0xFF;(@\label{lst:grayscaler_rgb_end}@)
			output[index] = 0.3*r + 0.59*g + 0.11*b;(@\label{lst:grayscaler_output}@)
		}
	}
	
	return output;
}
\end{lstlisting}

Als Ausgabe liefert der Grayscaler einen Zeiger auf die neu berechneten acht Bit breiten Pixeldaten. \autoref{img:grayscaler_result} zeigt das Ergebnis des Grayscalings.

\begin{figure}[H]
	\centering
	\begin{subfigure}{.5\textwidth}
		\centering
		\includegraphics[width=.8\linewidth]{Bilder/euro.png}
		\caption[Eingabebild des Grayscalers]{Eingabebild des Grayscalers\\ $[$http://www.historia-hamburg.de/media/product/1ec/19-x-1-euro-satz-aus-19-euro-staaten-511.jpg$]$}
	\end{subfigure}%
	\begin{subfigure}{.5\textwidth}
		\centering
		\includegraphics[width=.8\linewidth]{Bilder/grayscale.png}
		\caption[Ausgabebild des Grayscalers]{Ausgabebild des Grayscalers\newline\newline\newline}
	\end{subfigure}
	\caption{Ein- und Ausgabebild des Grayscalers}
	\label{img:grayscaler_result}
\end{figure}
